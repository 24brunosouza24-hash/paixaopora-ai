generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Product {
  id          String   @id @default(cuid())
  category    String
  title       String
  description String?
  imageUrl    String?
  isActive    Boolean  @default(true)

  // "ACAI"  -> tem variantes + adicionais/caldas/extras
  // "COPO"  -> tem variantes + SABORES (choices), sem adicionais/extras/caldas
  // "SIMPLE"-> sem variantes, sem extras, só quantidade e preço base
  kind        String   @default("ACAI")

  // usado quando kind = "SIMPLE"
  basePriceCents Int  @default(0)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  variants    Variant[]
  choices     ProductChoice[]
}

model Variant {
  id         String   @id @default(cuid())
  productId  String
  label      String
  priceCents Int
  sortOrder  Int      @default(0)

  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model ProductChoice {
  id        String  @id @default(cuid())
  productId String
  name      String
  isActive  Boolean @default(true)
  sortOrder Int     @default(0)

  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model OptionItem {
  id         String   @id @default(cuid())
  type       String   // "adicionais", "caldas", "cremes", "frutas", "toppings"
  name       String
  priceCents Int      @default(0)
  isActive   Boolean  @default(true)
  sortOrder  Int      @default(0)
}

model StoreSettings {
  id        Int      @id @default(1) // singleton
  isOpen    Boolean  @default(true)
  updatedAt DateTime @updatedAt
}

model Order {
  id           String   @id @default(cuid())
  createdAt    DateTime @default(now())

  customerName String?
  phone        String?

  neighborhood String?
  street       String?
  addressLine  String?
  reference    String?

  payment      String?
  notes        String?

  subtotalCents Int     @default(0)
  deliveryFeeCents Int  @default(0)
  totalCents    Int     @default(0)

  usedPoints    Int     @default(0)
  earnedPoints  Int     @default(0)

  items         OrderItem[]
}

model OrderItem {
  id         String @id @default(cuid())
  orderId    String

  productId   String
  title       String
  kind        String
  variantLabel String?
  qty         Int
  unitPriceCents Int
  extrasJson  String? // guarda extras/choices como JSON

  order      Order @relation(fields: [orderId], references: [id], onDelete: Cascade)
}
